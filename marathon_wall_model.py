# -*- coding: utf-8 -*-
"""for streamlit

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1iAcb_LL1dY2KYyn7CoZd6wreZ01vZDrG
"""

import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from catboost import CatBoostRegressor

# --- –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´ ---
st.set_page_config(page_title="Marathon AI Predictor", layout="wide")

# --- –ó–ê–ì–†–£–ó–ö–ê –ú–û–î–ï–õ–ò ---
# –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª marathon_wall_model.cbm –ª–µ–∂–∏—Ç –≤ —Ç–æ–º –∂–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub
@st.cache_resource
def load_my_model():
    model = CatBoostRegressor()
    try:
        model.load_model('marathon_wall_model.cbm')
        return model
    except:
        st.error("–§–∞–π–ª –º–æ–¥–µ–ª–∏ 'marathon_wall_model.cbm' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!")
        return None

model = load_my_model()

# --- –ò–ù–¢–ï–†–§–ï–ô–° (–ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨) ---
st.sidebar.header("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—Ç–ª–µ—Ç–∞")
age = st.sidebar.slider("–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç", 18, 80, 35)
gender = st.sidebar.selectbox("–ü–æ–ª", ["M", "F"])
start_pace = st.sidebar.number_input("–¶–µ–ª–µ–≤–æ–π —Ç–µ–º–ø –Ω–∞ —Å—Ç–∞—Ä—Ç–µ (–º–∏–Ω/–∫–º)", 3.0, 9.0, 5.0, step=0.1)

st.sidebar.header("‚òÄÔ∏è –ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è")
temp = st.sidebar.slider("–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–∑–¥—É—Ö–∞ (¬∞C)", 0, 35, 15)
humidity = st.sidebar.slider("–í–ª–∞–∂–Ω–æ—Å—Ç—å (%)", 10, 95, 50)
wind = st.sidebar.slider("–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ (–∫–º/—á)", 0, 30, 10)

# --- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù ---
st.title("üèÉ AI –ü—Ä–æ–≥–Ω–æ–∑ '–ú–∞—Ä–∞—Ñ–æ–Ω—Å–∫–æ–π —Å—Ç–µ–Ω—ã'")
st.markdown("""
–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ –≤—ã –∑–∞–º–µ–¥–ª–∏—Ç–µ—Å—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –∫–º –º–∞—Ä–∞—Ñ–æ–Ω–∞
–ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º –ø–æ–≥–æ–¥—ã –∏ –≤–æ–∑—Ä–∞—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –∞–ª–≥–æ—Ä–∏—Ç–º **CatBoost**.
""")

if model:
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
    input_data = pd.DataFrame([[age, gender, start_pace, temp, humidity, wind]],
                              columns=['age', 'gender', 'p_start', 'temp', 'hum', 'wind'])

    # –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
    prediction = model.predict(input_data)[0]

    # –†–∞—Å—á–µ—Ç—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
    labels = ['–°—Ç–∞—Ä—Ç (0-20 –∫–º)', '–¢—Ä–∞–Ω–∑–∏—Ç (20-30 –∫–º)', '–§–∏–Ω–∏—à (30-40 –∫–º)']
    # –ù–µ–±–æ–ª—å—à–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–π –∫—Ä–∏–≤–æ–π
    pace_points = [
        start_pace,
        start_pace * (1 + (prediction * 0.35) / 100),
        start_pace * (1 + prediction / 100)
    ]

    # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö
    col1, col2 = st.columns([1, 2])

    with col1:
        st.metric("–ü—Ä–æ–≥–Ω–æ–∑ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è", f"{prediction:.1f}%")
        st.write(f"**–í–∞—à —Ç–µ–º–ø –Ω–∞ —Ñ–∏–Ω–∏—à–µ:** {pace_points[2]:.2f} –º–∏–Ω/–∫–º")

        if prediction > 15:
            st.warning("‚ö†Ô∏è –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ '–≤—Å—Ç—Ä–µ—á–∏ —Å–æ —Å—Ç–µ–Ω–æ–π'!")
            st.info(f"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –Ω–∞—á–Ω–∏—Ç–µ –Ω–∞ {prediction*1.5:.0f} —Å–µ–∫/–∫–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–≥–æ.")
        else:
            st.success("‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Ç–µ–º–ø–∞.")

    with col2:
        # –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
        fig, ax = plt.subplots(figsize=(10, 6))
        sns.lineplot(x=labels, y=pace_points, marker='o', markersize=12, lw=4, color='red', ax=ax)
        ax.set_ylabel("–¢–µ–º–ø (–º–∏–Ω/–∫–º)")
        ax.set_title("–î–∏–Ω–∞–º–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º–ø–∞")
        ax.grid(True, linestyle='--', alpha=0.6)
        st.pyplot(fig)
